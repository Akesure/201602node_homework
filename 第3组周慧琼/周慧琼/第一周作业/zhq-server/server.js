#!/usr/bin/env nodevar http = require('http'),    path = require('path'),    fs = require('fs'),    mime = require('mime');var port = process.argv[2] ? process.argv[2] : 9999;var htmlMain = '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Title</title></head><body><div></div></body></html>';http.createServer(function(request,response){    //直接访问根目录    var url = request.url;    if(url == '/'){        fs.readdir('.',function(err,file){            response.end(htmlMain.replace('<div></div>',readFileFn(file)));            return;        });    }else{        //判断文件是不是存在这个目录        fs.exists('./' + url,function(exists){            if(exists){                //异步读取文件信息，判断是文件还是文件夹                fs.stat('.' + request.url,function(err,inf){                    if(err){                        response.write('不是文件不读取，你回去吧！','utf-8');                        response.end();                        return;                    };                    if(inf.isFile(inf)){//文件                        //读取文件内容                        response.setHeader('Content-type',mime.lookup(url) + ';charset=utf-8');                        fs.readFile('./'+request.url,function(err,data){                            response.write(data);                            response.end();                        });                    }else{                        fs.readdir('./' + request.url,function(err,file){                            response.end(htmlMain.replace('<div></div>',readFileFn(file)));                            return;                        });                    };                });            }else{                response.end('文件不存在');            };        })    };}).listen(port,function(){    console.log('端口' + port + '启动');});function readFileFn(file){    var html = '<ul>';    file.forEach(function(item,index){        html  +='<li><a href="./'+item+'">'+item+'</a></li>'    });    html += '</ul>';    return html;};